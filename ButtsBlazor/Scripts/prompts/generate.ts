import 'story-show-gallery/dist/ssg.min.css';
import SSG from 'story-show-gallery/src/ssg.esm'
export * from './gradio';
//import * as generate from './gradio';
console.log("loading generate");
console.error("Loading error:");
//(<any>window).generate=generate
export function gallery() {
    (<any>SSG).jQueryImgSelector = "a[href$='.jpg'],a[href$='.jpeg'],a[href$='.JPG'],a[href$='.JPEG'],a[href$='.png'],a[href$='.PNG'],a[href$='.gif'],a[href$='.GIF'],a[href$='.webp'],a[href^='data']"
    SSG.run({
        noExit: true,
        fs: true,
        cfg: {
            theme: 'black',
            socialShare: false,
            hideImgCaptions: false,
            observeDOM: true,
            preferedCaptionLocation: 300,
            showLandscapeHint: false,
            rightClickProtection: false
        }
    });
    setTimeout(() => $('#SSG_menu').remove(), 100);
}

export function closeGallery() {
//    SSG.closeFullscreen();
    SSG.destroyGallery(null);
}
//export default generate
/*
"use strict";(self.webpackChunkbuttsweb=self.webpackChunkbuttsweb||[]).push([[7,629],{2244:(e,n,t)=>{t.r(n),t.d(n,{closeGallery:()=>i,configure:()=>o.configure,gallery:()=>c,generate:()=>o.generate,generateCanny:()=>o.generateCanny,generatePromptImage:()=>o.generatePromptImage,resetConfig:()=>o.resetConfig,saveConfig:()=>o.saveConfig,toBlob:()=>o.toBlob});var a=t(2714),o=t(6535),r=t(3193);function c(){a.Z.jQueryImgSelector="a[href$='.jpg'],a[href$='.jpeg'],a[href$='.JPG'],a[href$='.JPEG'],a[href$='.png'],a[href$='.PNG'],a[href$='.gif'],a[href$='.GIF'],a[href$='.webp'],a[href^='data']",a.Z.run({noExit:!0,fs:!0,cfg:{theme:"black",socialShare:!1,hideImgCaptions:!1,observeDOM:!0,preferedCaptionLocation:300,showLandscapeHint:!1,rightClickProtection:!1}}),setTimeout((()=>r("#SSG_menu").remove()),100)}function i(){a.Z.destroyGallery(null)}},6535:(e,n,t)=>{t.r(n),t.d(n,{configure:()=>r,default:()=>m,generate:()=>y,generateCanny:()=>s,generatePromptImage:()=>p,resetConfig:()=>l,saveConfig:()=>f,toBlob:()=>i});var a=t(6259);const o={uriBase:"http://butts.infinitebutts.com"};function r(e,n){o.uriBase=e,o.hfToken=n}async function c(e){return await(0,a.Lp)(o.uriBase,{hf_token:`hf_${o.hfToken}`,status_callback:e})}async function i(e){if("string"!=typeof e)return e;const n=await fetch(e);return await n.blob()}async function s(e,n,t){const a=[await i(e)].concat(u(n)),o=await h("/generate_canny",a,t);return console.log(o),o.data[0]}function u(e){return[e?.controlImgSize??768,e?.scale??!0,e?.scaleUp??!0,e?.crop??!0,e?.scaleDimension,e?.cannyLow??100,e?.cannyHigh??200]}async function f(e){await c();const n=await h("/save_config",[e?.numOutputs,e?.imgSize,e?.numSteps,e?.controlScale].concat(u(e.cannyConfig)));return console.log(n),n}async function l(e){await c();const n=await h("/reset_config",[]);return console.log(n),n}function g(e){e&&"function"!=typeof e&&e.dispose()}async function y(e,n,t,a,o){try{const r=await s(e,a?.cannyConfig,o);return await p(r,n,t,a,o)}finally{g(o)}}async function p(e,n,t,a,o){const r=await i(e);try{const e=await h("/generate_prompt",[r,n,t,a?.numOutputs??2,a?.imgSize??1024,a?.numSteps??40,a?.controlScale??.45],o);return console.log(e),e.data}catch(e){console.error(e)}}async function h(e,n,t,a){const o=await c();let r=!1,i=!1,s=!1;return new Promise(((c,u)=>{let f,l=function(e){return e?"function"==typeof e?e:n=>e.invokeMethodAsync("Callback",n):null}(t);try{let t;f=o.submit(e,n,a),f.on("data",(e=>{i&&(f.destroy(),g(l),l=null,c(e)),r=!0,t=e})).on("status",(e=>{l&&l(e),"error"===e.stage&&(s=!0,g(l),l=null,u(e)),"complete"===e.stage&&(i=!0,r&&(f.destroy(),g(l),l=null,c(t)))}))}catch(e){f&&r&&(f.destroy(),g(l),l=null),r||i||s||u(e)}}))}const m={configure:r,generateCanny:s,generatePromptImage:p,generate:y,resetConfig:l,saveConfig:f,toBlob:i}}},e=>{e.O(0,[729,216],(()=>{return n=2244,e(e.s=n);var n}));var n=e.O();window.generate=n}]);
//# sourceMappingURL=generate.js.map?ver=82d1fbb9e0327d49fc61

{"version":3,"file":"js/generate.js?ver=82d1fbb9e0327d49fc61","mappings":"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","sources":["webpack://buttsweb/./Scripts/prompts/generate.ts","webpack://buttsweb/./Scripts/prompts/gradio.ts"],"sourcesContent":["import 'story-show-gallery/dist/ssg.min.css';\r\nimport SSG from 'story-show-gallery/src/ssg.esm'\r\nexport * from './gradio';\r\n\r\nexport function gallery() {\r\n    (<any>SSG).jQueryImgSelector = \"a[href$='.jpg'],a[href$='.jpeg'],a[href$='.JPG'],a[href$='.JPEG'],a[href$='.png'],a[href$='.PNG'],a[href$='.gif'],a[href$='.GIF'],a[href$='.webp'],a[href^='data']\"\r\n    SSG.run({\r\n        noExit: true,\r\n        fs: true,\r\n        cfg: {\r\n            theme: 'black',\r\n            socialShare: false,\r\n            hideImgCaptions: false,\r\n            observeDOM: true,\r\n            preferedCaptionLocation: 300,\r\n            showLandscapeHint: false,\r\n            rightClickProtection: false\r\n        }\r\n    });\r\n    setTimeout(() => $('#SSG_menu').remove(), 100);\r\n}\r\n\r\nexport function closeGallery() {\r\n//    SSG.closeFullscreen();\r\n    SSG.destroyGallery(null);\r\n}","import { client, SpaceStatus } from \"@gradio/client\";\r\nimport { Status, Payload, LogMessage } from \"@gradio/client/src/types\";\r\nimport { DotNet } from \"@microsoft/dotnet-js-interop\";\r\n\r\nexport interface CannyConfig {\r\n\tcontrolImgSize?: number,\r\n\tscale?: boolean,\r\n\tscaleUp?: boolean,\r\n\tcrop?: boolean,\r\n\tscaleDimension?: string,\r\n\tcannyLow?: number,\r\n\tcannyHigh?: number\r\n}\r\n\r\nexport interface PromptConfig {\r\n\tnumOutputs: number,\r\n\timgSize?: number,\r\n\tnumSteps?: number,\r\n\tcontrolScale?: number,\r\n\tcannyConfig: CannyConfig\r\n}\r\n\r\ntype SpaceStatusCallback = (status: SpaceStatus) => void;\r\nexport interface ClientConfig {\r\n\turiBase: string,\r\n\thfToken?: string\r\n}\r\n\r\nconst clientConfig:ClientConfig = {\r\n\turiBase: \"http://butts.infinitebutts.com\",\r\n} \r\nexport function configure(uriBase: string, hfToken?:string) {\r\n\tclientConfig.uriBase = uriBase;\r\n\tclientConfig.hfToken = hfToken;\r\n}\r\n\r\nasync function getClient(statusCallback?:SpaceStatusCallback) {\r\n\treturn await client(clientConfig.uriBase, {\r\n\t\thf_token: `hf_${clientConfig.hfToken}`,\r\n\t\tstatus_callback: statusCallback\r\n\t});\r\n}\r\n\r\nexport async function toBlob(imageUrl: string | Blob): Promise<Blob> {\r\n\tif (typeof imageUrl != \"string\")\r\n\t\treturn imageUrl;\r\n\tconst response_0 = await fetch(imageUrl);\r\n\treturn await response_0.blob();\r\n}\r\n\r\n\r\n\r\nexport async function generateCanny(srcImage: string | Blob, data: CannyConfig, callbackObj?: DotNet.DotNetObject | StatusCallback): Promise<Blob> {\r\n\tconst srcImageBlob = await toBlob(srcImage)\r\n\tconst args = [\r\n\t\tsrcImageBlob, \t// blob in 'Source' Image component\t\t\r\n\t].concat(toArgs(data));\r\n\tconst result = await run<Blob>(\"/generate_canny\", args,callbackObj);\r\n\r\n\tconsole.log(result);\r\n\treturn result.data[0];\r\n}\r\n\r\nfunction toArgs(data: CannyConfig) : any[] {\r\n\treturn [\r\n\t\tdata?.controlImgSize ?? 768, // number  in 'Target Size' Number component\t\t\r\n\t\tdata?.scale ?? true, // boolean  in 'Scale?' Checkbox component\t\t\r\n\t\tdata?.scaleUp ?? true, // boolean  in 'Scale Up?' Checkbox component\t\t\r\n\t\tdata?.crop ?? true, // boolean  in 'Crop?' Checkbox component\t\t\r\n\t\tdata?.scaleDimension, // string (Option from: [('SHORT', 'SHORT'), ('LONG', 'LONG')]) in 'Scale Dimension' Dropdown component\t\t\r\n\t\tdata?.cannyLow ?? 100, // number  in 'Canny Low' Number component\t\t\r\n\t\tdata?.cannyHigh ?? 200, // number  in 'Canny High' Number component\r\n\t]\r\n}\r\n\r\nexport async function saveConfig(data: PromptConfig) {\r\n\tconst app = await getClient();\r\n\r\n\tconst result = await run<any>(\"/save_config\", [\r\n\t\tdata?.numOutputs,\r\n\t     data?.imgSize, // number  in 'Image Size' Number component\r\n\t     data?.numSteps, // number  in 'Num. Steps' Number component\r\n\t\t data?.controlScale, // number  in 'Control Scale' Number component\r\n\t\t ].concat(toArgs(data.cannyConfig))\r\n\t); \r\n\tconsole.log(result);\r\n\treturn result;\r\n}\r\n\r\n//export interface PredictReturn<T> {\r\n//\tdata: T[],\r\n//\tendpoint: string,\r\n//\tfn_index: number,\r\n//\ttime: object,\r\n//\ttype: string,\r\n//\tevent_data: unknown\r\n//}\r\nexport async function resetConfig(uriBase: string) {\r\n\tconst app = await getClient();\r\n\tconst result = await run<any>(\"/reset_config\", []);\r\n\r\n\tconsole.log(result);\r\n\treturn result;\r\n}\r\nfunction toStatusCallback(callbackObj?: DotNet.DotNetObject | StatusCallback): StatusCallback {\r\n\tif (!callbackObj) return null;\r\n\tif (typeof callbackObj == \"function\")\r\n\t\treturn callbackObj;\r\n\treturn status => callbackObj.invokeMethodAsync(\"Callback\", status);\r\n}\r\nfunction disposeStatusCallback(callbackObj?: DotNet.DotNetObject | StatusCallback) {\r\n\tif (!callbackObj)\r\n\t\treturn;\r\n\tif (typeof callbackObj != \"function\")\r\n\t\tcallbackObj.dispose();\r\n}\r\nexport async function generate(srcImage: string, prompt: string, negative: string, data: PromptConfig, callbackObj?: DotNet.DotNetObject | StatusCallback) {\r\n\ttry {\r\n\t\tconst canny = await generateCanny(srcImage, data?.cannyConfig, callbackObj);\r\n\t\treturn await generatePromptImage(<Blob><any>canny, prompt, negative, data, callbackObj);\r\n\t}\r\n\tfinally {\r\n\t\tdisposeStatusCallback(callbackObj);\r\n\t}\r\n}\r\nexport async function generatePromptImage(cannyImage: string | Blob, prompt: string, negative: string, data: PromptConfig, callbackObj?: DotNet.DotNetObject | StatusCallback): Promise<string[]> {\r\n\tconst cannyBlob = await toBlob(cannyImage)\r\n\ttry {\r\n\t\tconst result = await run<string>('/generate_prompt', [\r\n\t\t\tcannyBlob, \t// blob in 'ControlNet Output' Image component\t\t\r\n\t\t\tprompt, // string  in 'Prompt' Textbox component\t\t\r\n\t\t\tnegative, // string  in 'Negative Prompt' Textbox component\t\t\r\n\t\t\tdata?.numOutputs ?? 2,\r\n\t\t\tdata?.imgSize ?? 1024, // number  in 'Image Size' Number component\t\t\r\n\t\t\tdata?.numSteps ?? 40, // number  in 'Num. Steps' Number component\t\t\r\n\t\t\tdata?.controlScale ?? 0.45, // number  in 'Control Scale' Number component\r\n\t\t],callbackObj);\r\n\t\tconsole.log(result);\r\n\t\treturn result.data;\r\n\t}\r\n\tcatch(e) {\r\n\t\tconsole.error(e);\r\n\t}\r\n}\r\ntype SubmitEvent = { type: string; endpoint: string; fn_index: number };\r\nexport interface PayloadResponse<T> {\r\n\tdata: T[];\r\n\tfn_index?: number;\r\n\tevent_data?: unknown;\r\n\ttime?: Date;\r\n}\r\n\r\ntype StatusEvent = Status & SubmitEvent;\r\ntype DataEvent<T> = PayloadResponse<T> & SubmitEvent;\r\ntype LogEvent = LogMessage & SubmitEvent;\r\ntype StatusCallback = (d: Status) => void;\r\nasync function run<T>(\r\n\tendpoint: string,\r\n\tdata: unknown[],\r\n\tcallbackObj?: DotNet.DotNetObject | StatusCallback,\r\n\tevent_data?: unknown): Promise<PayloadResponse<T>> {\r\n\tconst client = await getClient();\r\n\tlet data_returned = false;\r\n\tlet status_complete = false;\r\n\tlet error_sent = false;\r\n\treturn new Promise((res, rej) => {\r\n\t\tlet app;\r\n\t\tlet status_callback = toStatusCallback(callbackObj);\r\n\t\ttry {\r\n\t\t\tapp = client.submit(endpoint, data, event_data);\r\n\t\t\tlet result: PayloadResponse<T>;\r\n\t\t\tapp.on(\"data\", (d: DataEvent<T>) => {\r\n\t\t\t\t// if complete message comes before data, resolve here\r\n\t\t\t\tif (status_complete) {\r\n\t\t\t\t\tapp.destroy();\r\n\t\t\t\t\tdisposeStatusCallback(status_callback);\r\n\t\t\t\t\tstatus_callback = null;\r\n\t\t\t\t\tres(d);\r\n\t\t\t\t}\r\n\t\t\t\tdata_returned = true;\r\n\t\t\t\tresult = d;\r\n\t\t\t})\r\n\t\t\t\t.on(\"status\", (status: Status) => {\r\n\t\t\t\t\tif (status_callback) {\r\n\t\t\t\t\t\tstatus_callback(status);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (status.stage === \"error\") {\r\n\t\t\t\t\t\terror_sent = true;\r\n\t\t\t\t\t\tdisposeStatusCallback(status_callback);\r\n\t\t\t\t\t\tstatus_callback = null;\r\n\t\t\t\t\t\trej(status);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (status.stage === \"complete\") {\r\n\t\t\t\t\t\tstatus_complete = true;\r\n\t\t\t\t\t\t// if complete message comes after data, resolve here\r\n\t\t\t\t\t\tif (data_returned) {\r\n\t\t\t\t\t\t\tapp.destroy();\r\n\t\t\t\t\t\t\tdisposeStatusCallback(status_callback);\r\n\t\t\t\t\t\t\tstatus_callback = null;\r\n\t\t\t\t\t\t\tres(result);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t}\r\n\t\tcatch (e) {\r\n\t\t\tif (app && data_returned) {\r\n\t\t\t\tapp.destroy();\r\n\t\t\t\tdisposeStatusCallback(status_callback);\r\n\t\t\t\tstatus_callback = null;\r\n\t\t\t}\r\n\t\t\tif (!data_returned && !status_complete && !error_sent)\r\n\t\t\t\trej(e);\r\n\t\t}\r\n\t});\r\n\r\n}\r\n\r\nexport default {\r\n\tconfigure,\r\n\tgenerateCanny,\r\n\tgeneratePromptImage,\r\n\tgenerate,\r\n\tresetConfig,\r\n\tsaveConfig,\r\n\ttoBlob\r\n}"],"names":["gallery","jQueryImgSelector","run","noExit","fs","cfg","theme","socialShare","hideImgCaptions","observeDOM","preferedCaptionLocation","showLandscapeHint","rightClickProtection","setTimeout","$","remove","closeGallery","destroyGallery","clientConfig","uriBase","configure","hfToken","async","getClient","statusCallback","hf_token","status_callback","toBlob","imageUrl","response_0","fetch","blob","generateCanny","srcImage","data","callbackObj","args","concat","toArgs","result","console","log","controlImgSize","scale","scaleUp","crop","scaleDimension","cannyLow","cannyHigh","saveConfig","numOutputs","imgSize","numSteps","controlScale","cannyConfig","resetConfig","disposeStatusCallback","dispose","generate","prompt","negative","canny","generatePromptImage","cannyImage","cannyBlob","e","error","endpoint","event_data","client","data_returned","status_complete","error_sent","Promise","res","rej","app","status","invokeMethodAsync","toStatusCallback","submit","on","d","destroy","stage"],"sourceRoot":""}
*/  